<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Auto-SLM</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: auto;
        }

        textarea,
        input {
            width: 100%;
            margin-top: 8px;
        }

        button {
            margin-top: 8px;
        }

        pre {
            background: #111;
            color: #0f0;
            padding: 10px;
        }
    </style>
</head>

<body>

    <h2>Auto-SLM (RAG)</h2>

    <label>Project ID</label>
    <input id="project" value="demo" />

    <h3>Add Knowledge</h3>
    <textarea id="doc" rows="6" placeholder="Paste any text here..."></textarea>
    <button onclick="addDoc()">Add</button>

    <h3>Ask Question</h3>
    <textarea id="question" rows="3"></textarea>
    <button onclick="chat()">Ask</button>

    <h3>Answer</h3>
    <pre id="out"></pre>

    <script>
        // IMPORTANT: this must be your ngrok URL
        const API = window.location.origin;

        async function addDoc() {
            const res = await fetch(API + "/add", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    project_id: document.getElementById("project").value,
                    text: document.getElementById("doc").value
                })
            });
            alert("Document added");
        }

        async function chat() {
            document.getElementById("out").textContent = "";

            const res = await fetch(API + "/infer/stream", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    project_id: document.getElementById("project").value,
                    prompt: document.getElementById("question").value
                })
            });

            const reader = res.body.getReader();
            const decoder = new TextDecoder();

            while (true) {
                const { value, done } = await reader.read();
                if (done) break;
                document.getElementById("out").textContent += decoder.decode(value);
            }
        }
    </script>

</body>

</html>